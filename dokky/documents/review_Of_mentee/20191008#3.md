## 1. 한주간 진행하였던 것들

* AWS 계정 MFA활성화 정상 작동 확인

* RDS 프리티어 재생성시 계속된 막힘 문제

* S3를 활용한 업로드,다운로드 구현중 


## 2. 진행중 겪었던 모든것들 


### 1) html a태그에서 파일을 다운로드할때 이름을 변경할수 없을까..?

파일이 uuid 로 이름이 변경되어 저장되있어서 다운로드시 다시 원본이름으로 되돌려줘야 하는문제가 있는데..

s3에서 다운로드 하는 가장 쉬운 첫번째 방법은 s3로 업로드된 파일의 링크를 얻어서 다운로드하는것인데

이 링크를 a태그 href속성에 입력시켜주면 파일의 원본이름을 가져올수 없다는것이다..

a태그의 download 속성값에 download="dokky.png" 라고 넣어주면 이름이 변경된다고 하는데 소용이없다..

<a href="https://picksell-bucket.s3.ap-northeast-2.amazonaws.com/upload/2019/10/08/0a38de9a-5d3a-463b-8319-377c821de9d9_dokky.png" download="dokky.png">다운로드</a>

https://picksell-bucket.s3.ap-northeast-2.amazonaws.com/upload/2019/10/08/0a38de9a-5d3a-463b-8319-377c821de9d9_dokky.png" download="dokky.png"


### 2) 퍼블릭,프라이빗 접근의 복잡한..설정문제..
 
s3에서 업로드와 다운로드를 할때 로그인한 회원에게만 파일 업로드와 다운로드를 제공하고싶다. 

왜냐하면 아무나 외부에서 대량 요청시(다운로드,업로드) 서버 과금발생을 막기 위해서인데,

이 설정을 제대로 잡는게 굉장히 복잡하고 진입하기 어렵다..

### 업로드의 경우///////////////////////////////////////////////////

ec2에서 s3로 업로드를 할때 aws계정 인증이 기본적으로 필요하다

첫번째 방법은 : aws루투 계정에서 하위 사용자(s3의 모든 관리 권한이 부여된)의 계정을 생성한다.

 그리고 업로드전 자바 코드안에 이 사용자의 Access key ID와   Secret access key를 입력하여 증명을 한다.
 
 하지만 이 방법이 느낌상 좋지않다. 코드안에 중요한 아이디와 비밀번호가 들어간다는것 자체부터..좋지않다.
 
 
두번재 방법은: IAM 역할이라는 것이있는데, 이 하나의 역할에 정책(AmazonS3FullAccess)을 만들고 이 역할을 EC2에 적용해준다.

그러면 ec2에서 s3로 접근할시에는 s3의 모든 관리 권한을 EC2는 부여받는것이다.

이렇게 되면  굳이 사용자라는것을 안만들어도, Access key ID와   Secret access key를 코드상에 입력하지 않아도, s3의 관리 권한을 가진다고 알고있다.

그래서 IAM 역할을 EC2에 적용까지 해놓았는데 빌드가 계속 실패되서 테스트를 못하고있다..현재는 사용자로 접속해서 하는중..
 
### 다운로드의 경우 ///////////////////////////////////////////////////

첫번째 : 링크를 받아서 다운받게 되면 

문제점 1. 파일의 이름변경을 못한다. 

문제점 2. 퍼블릭으로 아무나 접근해서 다운받을수있다. 이걸어떻게 못막는것인가.. 

두번째: 업로드처럼 EC2에 IAM 역할적용해서 직접 다운로드 구현..

원래 구현되어있던 다운로드 방식과 s3의 api를 이용한 다운로드방식이 달라서 어떻게 조합을 해야할지 헤매고있다..


### 3) s3로 업로드 해야할 항목은..?

기존에는 ec2로 파일과,이미지 모두 올리고 있었다.

그런데 이것을 S3로 파일과 이미지를 바꿔 올리려한다.

현재, ec2의 경우 750시간,30GB 무료이고 

S3의 경우는 표준 스토리지 5GB, GET 요청 20,000건, PUT 요청 2,000건으로 트래픽에 대한 요금이 발생한다.

이해할 수 없는건 벌써 S3의 경우 일주일도 안되서 30퍼센트 GET 요청이 이루어졌다.

이대로 가다간 금방 과금이 발생할것만 같다. 저 정도의 요청을 하지는 않았던것 같은데..

S3의 경우 트래픽에 대한 요금이 발생해 굉장히 조심스럽다..

게시글의 다운로드 파일같은경우는 회원들이 클릭을 할때만 S3로 요청을 하겠지만, 

이미지 파일같은경우는 비회원까지 포함해서 게시글을 읽는 것만으로도 요청이 수많이 들어갈텐데

그러면 이미지들은 그냥 EC2에다가 저장을 하는것이 비용문제를 줄일수 있는것일까..?

현재 게시글 쓰기 페이지에서 파일과,이미지를 올릴수 있는데..

문제는 이미지도 s3로 올려야 하는지 잘 모르겠다.

ec2와 분리해서 s3를 사용하는 이유가 있을텐데..