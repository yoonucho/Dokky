## 1. Dokky서버로 정상적으로 배포 되지 않는 현상

Dokky서버의 톰캣이 돌지 못하는 현상(8080포트 닫힘):  

1) 결론 : 해결 완료 - 정상적으로 deploy할 수 있는 상태로 복구

2) 원인 :
 
 	dependency의 버전 변경이 1차적 원인
 	
 	spring-security-web의 dependency 버전이 5.0.7 > 5.0.13 변경후
 	
 	연관되어진 spring-web의 dependency 버전이 5.0.8 > 5.0.15로 자동변경 되버림
 	(dependency는 연관되어진 dependency까지 다운로드하거나 업데이트 해버리기 때문일듯)

 	데스크탑의 Dokky\dokky\target\dokky-1.0.0-BUILD-SNAPSHOT\WEB-INF\lib 폴더 안의
 	
 	spring-web이라는 이름을 갖는 jar파일이 2개가 생성후
 	
 	spring-web-5.0.15.RELEASE.jar 
 	spring-web-5.0.8.RELEASE.jar
 	
 	dokky서버로 2가지 jar 파일 배포된것
 	
 	하지만 지금까지 2가지 버전이 배포된다해도 문제가 없었다.
 	
 	이것말고도 여러가지 다른 jar파일들 또한 2가지 버전이 함께 배포되어있음에도 불구하고..
 	
 	희한하게 예외적으로  spring-web의 경우만 2가지 버전이 함께 배포되면 프로젝트가 돌지 못한다..
 	
 	정리하자면 버전을 변경하면 jar파일이 중복해서 생성이 되고, 그게 중복적으로 배포가 되는현상이 일어나는것인데
 	
 	이게 메이븐도구 성능의 문제인건지는 테스트가 필요하다 gradle도 이러는지는 모르겠으나
 	
 	정리하자면 가장 간편한건 버전을 변경하더라도 중복된 jar파일을 배포하지않는게 가장 좋은것 같다. 
 	
3) 해결방법 

 	- 배포 할때마다 spring-web jar파일 중 예전 버전을 dokky서버에서 반복적으로 삭제해준다(임시방법)
 	(rm spring-web-5.0.15.RELEASE.jar)
 	
 	- 애초에 배포 할때 한 버전만 배포되도록 한다(완전 해결 방법)
 	 	
 	- 데스크탑의 Dokky\dokky\target 폴더를 지우고 다시 배포한다
 	(폴더를 지울경우 다시 deploy를 할때 하나의 jar파일만 생성해서 target 폴더에 보관후 배포를 해준다)
 	
 	- 또는 이클립스 run as > maven clean 버튼을 통해 dokky서버를 clean 해준다. 톰캣을 clean하는게 아니다.
 	(그러면 target 폴더와 연관된 파일 및 기타적인것들을 삭제시켜준다.
 	그리고 위처럼  다시 deploy를 할때 하나의 jar파일만 생성해서 target 폴더에 보관후 배포해준다)
 	
 	- 빌드 도구의 변경?(gradle)
 	
4) 제대로 모르고 있던 것 및 문제해결 과정에서 느낀점 및 대비책들
	
 	- maven을 따라하기식의 사용만 했을뿐 뭔지도 모르고 써온것 같다.
 	
 	- 현재 내 환경에서 maven의 라이프 사이클이 어떻게 돌아가는지 제대로 알지 못했다.
 	
 	- 데스크탑의 프로젝트서부터 dokky서버로 배포되는 전 과정에 대한 이해 부족
 	
 	- 1) 이클립스에서 pom.xml의 dependency버전을 설정하게되면
 	- 2) 데스크탑의 .m2폴더에 dependency들이 다운로드 된다
 	- 3) 이클립스에서 톰캣을 통해 프로젝트를 돌리면 C:\Users\champ.m2\repository 폴더안의 dependency들이
 	 F:\java\GitApp\Dokky\dokky\target\dokky-1.0.0-BUILD-SNAPSHOT\WEB-INF\lib 폴더안에
 	복사된다 
 	- 4) 데스크탑의 톰캣은 저 target의 lib들의 dependency를 가주고 프로젝트를 돌리는것이다 .m2폴더에 dependency들이 아님
 	- 5) dokky서버로 deploy할때도 target의 lib폴더안의 dependency와 target안의 jar파일을 그대로 배포하는것
 	
 	- 계속해서 배포되는 dependency들을 dokky서버쪽에서 찾으려했던것..or 데스크탑의 m2폴더라고 계속 생각했던것
 	그래서 target폴더에 대한 인지 자체를 못하고 있어 문제해결의 어려움을 겪음 
 	- 평소 커밋할때 뜨던 target에 대한 관심 부족 + 그냥 알아서 자동적으로 배포해주는거에 익숙
 	- 포스팅 따라하기식 개발의 결과는 부작용을 가져오고, 문제해결하는데 큰 어려움을 가져온다
	- 급하다고 건물을 빠르게 올리듯이 진도를 나가는게 추후 문제해결 및 커스텀 이런곳에서 엄청 고생을 하게되는것 같다
 	- 이론적으로 대충 알고있던 maven보다는 직접 경험하는 maven을 통해 maven이 무엇을 하는지 이해 할 수 있다.
 		
 	- 위에서 처럼 dependency 버전을 오리지날로 변경한다해도 배포 대상인 target의 폴더안에 버전이 2개가 존재한다면 2가지다 배포되기 때문
 	에 아무리 dependency 버전을 변경,새로운 프로젝트 branch를 만들어 배포를 해도 배포안됬던것
 	
 	- 다른 프로젝트를 dokky서버로 가져와 배포하면 잘만 배포됬던것은 spring-web의 버전이 2가지가 존재하지 않았기 때문
 	
 	- 어딘가 dokky서버안에서 문제가 있는것으로 생각하고 데스크탑에 문제가 있다고 생각을 잘 못했음
	근본 원인에 대한 파악을 잘못하니 문제해결이 느린것
		
 	- 근본 원인을 파악 못하니 문제해결이 길어졌다.
 	
 	파악 못한 이유는 메이븐도구를 이용해 데스크탑에서 dokky서버로의 전 과정에 대한 이해 부족 
	 	
 	- 이클립스에서 배포후 콘솔에 찍히는 오류 로그는 매우 포괄적이다라는 특징을 잊고 있었음
 	( Failed to execute goal org.codehaus.mojo:tomcat-maven-plugin:1.1:deploy   
 	(default-cli) on project dokky: Cannot invoke Tomcat manager: 
 	FAIL - Deployed application at context path [/dokky] but context failed to start -> [Help 1]  	)
 	이 로그는 배포가 안되는 여러가 상황에서 나오기 때문에..문제해결하는데 큰 도움이 되지는 못한다. 이러한 특징들을 모두 기억못하고 헤매니
 	내 프로젝트 환경의 특징 리스트를 만들고 문제가 풀리지 않을때마다 한번씩 돌아본다면 대비책이 될것같다
 	
 	- 배포후 톰캣 로그에 찍힌 로그를 구글링 해보고 꼼꼼히 다시 봐보자
 	Caused by: java.lang.IllegalArgumentException: More than one fragment with the name [spring_web] was found.  
 	This is not legal with relative ordering.  
 	See section 8.2.2 2c of the Servlet specification for details. Consider using absolute ordering.  
 	사실 이 로그에서 [spring_web] 이라는 것을 보고 감이 안와서 그냥 지나쳐 버렸다. 딱히 구글링에서  저 [spring_web]단어에 대한 언급도 못찾았었다.
 	단서가 톰캣 로그에 있었는데 놓친 부분이 아쉽다. 좀더 근본적인 문제해결은 톰캣 로그에 있으니 이클립스 콘솔보다 직접 톰캣 로그를 잘찍어보자
 	
 	- 리눅스에서 명령어에 대한 활용 부족과 두려움
 	find / -name 'spring*'과 같은 명령어를 처음부터 활용못한것..그외 리눅스에의 명령어들에 더욱 익숙해져야 한다
 	
 	- pom.xml의 디펜던시 버전의 업데이트 - 처음에 보안성 취약으로 업데이트 하라고 날라오는것을  
 	계쏙 미뤘던 이유도 무언가 프로젝트에 문제가 생길까봐 조심스러웠기에 계속 미루다 한것이였는데 이제 업데이트 하기가 무섭다..  
 	그렇다고 계속 업데트를 안하고 미루고 있을수는 없다..  
 	보안성이 취약하다는데 앞으로도 이런것을 겪을것이고 더빠른 문제해결을 위한 대비책이 필요하다  
 	
 	- 정상적으로 생각하면 버전을 되돌렸기에 오류가 없어야 하는게 맞는데..있는 경우이기 때문에 문제해결이 쉽지 않았다.
 	  이럴 경우 매우 답답한 상황에서, 그래도 분명 문제가있으니 돌아가지 않는것이니까 
 	  더욱 꼼꼼히 차분하게 찾아보려는 시도들이 필요하다  
	 차라리 다른 문제를 해결하고 있다보면 떠오를적도 있다.
 	
 	- 구글링만으로 정확한 답이 나오지 않는 경우도 많다. 구글링이 답지라고 접근하지말자.
 	 구글링은 흰트를 제공한다는 차원에서 접해야 할것이다.
 	계속 정확한 답 찾기 따라하기식의 포스팅등을 찾다보니 시간도 오래걸리고, 흰트를 지나쳐버릴수도 있다.
 	구글링을 하는 태도와 심리,기대의 변화도 필요할것이다.
 	흰트를 얻고 그것을 내프로젝트에서 어떻게 찾아갈것인지, 
 	어떻게 해결할것인지 생각하고 시도,비교,적용해보는 힘을 길러야 한다.  
 	그게 구글링을 의미있게 활용하는 것 같다. 
 	
 	- 의심가는 단서들을 하나하나씩 시도하고 비교해보면서 체크하다보면 실마리가 보일것이다.
 	
 	- 내 프로젝트 환경의 특징및 주의사항 리스트를 만들어보자
 	 	첫째로 사람의 기억에는 한계가 있다.
 	 	둘째로 사람은 멀티태스킹을 잘 하지못하는게 보통이라고 생각한다.
 	 	나의 프로젝트 환경의 모든것에 대한 변칙적인 특징들을 알고있어야 한다 나도 까먹게된다.
 	 	희한한 변수들..정상적이라고 누구나이렇게 될것이라고 생각하지만 그렇지 못한것들에 대한 정리와 복기가 필요하다
  	 	그래서 이러한 문제가 풀리지않는 예외적인 상황에 대비책으로는 
  	 	내 프로젝트의 특이사항, 주의사항들을 한눈에 볼수있게 기록을 해놔보자
   		한곳에만 집중하다보면 다른곳은 상대적으로 작아지고 보이지 않게된다.
 	 	그래서 이 문제해결에있어서 한쪽에 치우쳐 문제해결을 할것보다는 조금더 균등하게 맞춰서
  	 	문제를 다시 바라보고 넓은 관점에서 해결해나가야할것이다.
  	 	그게 시간이 걸릴지라도 이렇게 문제가 생기게 될때는
  	 	해결의 시간을 확 줄여주는 힘을 발휘할것이다.
 
 	- 문제발생이 되는곳은 상대적으로 관심이 덜한곳에서 문제발생하는것 같다. 
 	알아서 자동적으로 되는것들에 대한 관심부족

5) 추가적인 문제 발생

 	위와 같이 모든 버전을 변경하고 완료했더니
 	스프링 프레임워크 버전의 변경 풀리퀘스트 요청이 다시옴
 	5.0.7 > 5.2.4
 	버전 변경시 또 돌지 않는 현상 발생

## 2. Deployment할때 설정의 개선 필요성에 대한 방법 첫번째
 	
 	1) 1차적 문제점 : 
 	
 	 	배포후 dokky.ga/dokky >> 이렇게 접속해야 메인의 경로가 잡힌다
 	
 	 	배포후에 dokky.ga >> 이렇게 메인의 경로가 잡혀야 보기 편하다.
 		
 	 	이를 해결하기 위해서 
 	
 	2) 기존의 방법: 
 	
 	 	pom.xml에서 path에 대한 설정을 <path>/dokky</path>라 지정 한 후에 배포를 한다.
 	
 	 	배포한후의 경로설정을 위해 톰캣의 server.xml에서 Context docBase="dokky" path="/" 로 
 	
 	 	설정 후 주석을 풀어준다 그리고 다시 톰캣 재시작 필요 , 그후에 dokky.ga/main. 이라고 꼭 한번 접속을 해줘야...
 	
 	 	dokky.ga라고 접속해도 자동적으로 메인 화면으로 잡히게 된다. 이런한 특징을 잘 모르거나 잊어버리면 나중에 찾느라 또 고생한다
 	 	
 	 	또한 이러한 방법을 쓸경우 context가 2개가 생성, 세션도,쿠키도 2개가 생성되는 낭비가 발생한다
 	
 	3) 2차적 문제점 : 
 	
 	 	결과적으로 프로젝트를 배포한후에 경로에 대한 설정의 복잡성이 크고 유지보수하기 불편하고 자원 낭비가 있다.
 	
 	4) 개선된 방법: 
 	
 	 	톰캣의 server.xml의 설정 자체를 건드리지 않는 방법을 쓰자
 	
 	 	먼저 기본적으로 톰캣에 /경로로 배포된,내장된 ROOT를 undepoly해준다(/var/lib/tomcat9/webapps/ROOT 를 비워줌)
 	
 	 	server.xml의 Context docBase 설정은 주석처리를 그대로 해두고 앞으로도 건들지 말자
 	
 	 	pom.xml에서 <path>/</path>로 지정해준다 그러면 배포 되는 경로는
 	
 	 	/var/lib/tomcat9/webapps/ROOT 로 배포가 되버린다. ROOT.war도 생성
 	
 	 	그 후에 dokky.ga로 접속시 바로 메인으로 접속된다. 
 	
 	 	왜 이렇게 접속이 되냐면 톰캣의 기본 Document Root는 webapps/ROOT로 되어있다고 한다.
 	 	
 	 	http://내아이피:8080으로 접속시  기본적인 루트는 ROOT 디렉토리 밑이 된다는것이다.
 	 
 	 	제일 간단한 방법인데 단점 및 문제점이라고 아직까진 발견 못했다.
 	 	
 	 	https://dokky.ga/
 		
 	5) 간단한 방법을 오래도록 몰랐던 이유  :
 	
 	 	ROOT경로로 배포를 시도해본적은 있으나 안되길래 그냥 넘어갔다. 왜안될까 깊게 생각을 안해봤다.
 	 
 	 	ROOT폴더를 일단 비워야 배포가 된다. 기존에 기본적으로 배포되어있는 index.html등등이 있기 때문이다.
 	
 	6) 느낀점 : 
 	
 	 	개발을 하다 불편한점들이 있고 예외적으로 신경써줘야 하는부분들을 모두 기억한다는것은 어렵다. 
 	 	
 	 	이런부분들을 유지보수를 위해 개선할 생각도 가져보자

## 3. 지난주 못봤던   spring security authentication, logout custom 에 대해

https://github.com/ytw9699/Dokky/wiki/02.19~03.03.-%EB%A6%AC%EB%B7%B0
